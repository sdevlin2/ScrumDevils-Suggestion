<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Feedback</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet">
    <style>

        /* CSS */

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .feedback-container {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            height: 75vh;
            max-height: 800px;
        }

            .feedback-container textarea {
                width: 100%;
                height: 50vh;
            }

            .feedback-container h1 {
                text-align: center;
            }

            .feedback-container select, .feedback-container textarea, .feedback-container input {
                width: 100%;
                padding: 10px;
                margin: 10px 0;
                border: 1px solid #ddd;
                border-radius: 4px;
                box-sizing: border-box;
            }

            .feedback-container input[type="submit"] {
                background-color: #0056b3;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }

            .feedback-container input[type="submit"]:hover {
                background-color: #004494;
            }

        #topic{
            font-size: 200%;
        }

        #question{
            font-size: 150%;
        }

        #loginMessage {
            text-align: center;
            margin-top: 10px;
        }
    </style>

</head>
<body>

    <form><!--what does it do when submitted? action-->
        <div class="feedback-container">
            <h1>Select Topic and Questions</h1>

            <div>
                <label for="topicSelect">Select Topic:</label>
                <select id="topicSelect"></select>
            </div>

            <div>
                <label for="questionSelect">Select Question:</label>
                <select id="questionSelect"></select>
            </div>

            <div>
                <textarea id="feedbackValue"></textarea>
                <input type="submit" value="Submit Feedback">
            </div>
        </div>
    </form>

    <script type="text/javascript">
        // Function to fetch data from the web service
        function fetchData(url) {
            return fetch(url)
                .then(response => {
                    // Check if the response is successful (status code in the range 200-299)
                    // If response is not ok, throw an error
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(text => parseXMLResponse(text));
        }

        // Function to populate dropdown with options
        function populateDropdown(elementId, data) {
            var dropdown = document.getElementById(elementId);
            dropdown.innerHTML = "";
            // Loop through the data array and create an option element for each item
            data.forEach(function (item) {
                var option = document.createElement("option");
                option.value = item;
                option.textContent = item;
                // Append the option to the dropdown
                dropdown.appendChild(option);
            });
        }

        // Parse XML response
        function parseXMLResponse(xmlString) {
            // Create a parser object
            const parser = new DOMParser();
            // Parse XML into a document
            const xmlDoc = parser.parseFromString(xmlString, "text/xml");
            // Get all "string" elements
            const stringElements = xmlDoc.getElementsByTagName("string");
            // Array to store topics
            const topics = [];
            // Extract text content from each string element
            for (let i = 0; i < stringElements.length; i++) {
                topics.push(stringElements[i].textContent);
            }
            // Return topics array
            return topics;
        }

        // Fetch topics and populate the topics dropdown
        fetchData("ProjectServices.asmx/GetTopics")
            .then(function (topics) {
                populateDropdown("topicSelect", topics);
            })
            .catch(function (error) {
                console.error('Error fetching topics:', error);
            });

        // Get the topic from the dropdown and fetch questions based on topic
        document.getElementById("topicSelect").addEventListener("change", function () {
            var selectedTopic = this.value;
            fetchData("ProjectServices.asmx/GetQuestions?topicId=" + selectedTopic)
                .then(function (questions) {
                    populateDropdown("questionSelect", questions);
                })
                .catch(function (error) {
                    // Log an error message if fetching questions fails
                    console.error('Error fetching questions:', error);
                });
        });

    </script>

</body>
</html>
